@using System.Collections
@model TwitterSearch.Models.TweetSearch

@{
    ViewBag.Title = "Search";
}
<h1>Search Twitter</h1>

<div class="container">
    
    <span style="font-size:medium;font-weight:bold;">Search Mode</span>
    <ol class="searchModeSelection">
        @foreach (var searchMode in Model.SearchModes)
        {
            <li>
                @Html.RadioButton("searchMode", searchMode.ToString())
                @Html.Label(searchMode.ToString())
            </li>
        }
    </ol>
    
    <br />
   
    <div class="searchParameter">
        <span style="font-size:medium;font-weight:bold;">Hash Tag</span>
        <input type="text" id="tbHashTag" />
    </div>
    
    <div class="searchParameter">
        <span style="font-size:medium;font-weight:bold;">User Name</span>
        <input type="text" id="tbUserName" />
    </div> 
    
    <br />

    <input type="button" id="btnStartSearch" value="Start Search" />
    <input type="button" id="btnStopSearch" value="Pause Search" />
    <input type="button" id="btnResumeSearch" value="Resume Search" />
    
    <input type="hidden" id="userLoginName" />

    <ul id="tweetContents" class="tweetContainer"></ul>
    
</div>

@section scripts {
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <script src="~/Scripts/jquery.signalR-2.1.0.min.js"></script>

    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <!--SignalR script to update page -->
    <script>
        $(function () {
            //$.connection.hub.logging = true;
            
            // Reference the auto-generated proxy for the hub.
            var twitterHub = $.connection.twitterHub;

            // Create a function that the hub can call back to display messages.
            twitterHub.client.addTweetsToPage = function (tweetId, tweetText, tweetCreator, tweetLocation) {
                // Add the message to the page. 
                $('#tweetContents').append('<li><strong>' + htmlEncode(tweetId) + '</strong> <br />' +
                    htmlEncode(tweetText) + '<br />' +
                    htmlEncode(tweetCreator) + '<br />' +
                    htmlEncode(tweetLocation) + '</li>');
            };

            $('#userLoginName').val(prompt('Enter your username:', ''));

            $('#tbHashTag').focus();

            $.connection.hub.start().done(function () {
                $('#btnStartSearch').click(function () {
                    $('#tweetContents').append('<li><strong>connecting</stro‌​ng></li>');
                    $.connection.hub.start();
                    // Call the Send method on the hub. 
                    twitterHub.server.startSearch($('#userLoginName').val(), $('#tbHashTag').val(), $('#tbUserName').val());
                    //connection.start({ transport: ['webSockets', 'longPolling'] });
                });
            });
            
            $('#btnStopSearch').click(function () {
                
                $('#tweetContents').append('<li><strong>disconnected</stro‌​ng></li>');
                twitterHub.server.stopSearch($('#StopSearch').val());
                $.connection.hub.stop();
            });
            
            $('#btnResumeSearch').click(function () {
                $('#tweetContents').append('<li><strong>resumed</stro‌​ng></li>');
                $.connection.hub.start();
                twitterHub.server.startSearch($('#userLoginName').val(), $('#tbHashTag').val(), $('#tbUserName').val());
            });

            
            
            // Stop the connection.
            //$.connection.hub.start().done(function () {
            //    $('#btnStopSearch').click(function () {
            //        //chat.server.stopSearch();
            //        $.connection.hub.stop();
            //    });
            //});
            
            //chat.client.stopClient = function () {
            //    $.connection.hub.stop();
            //};
        });

        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}